{% extends "base.html" %}

{% block content %}
    <div class="row">
        <p><a href="javascript:history.back(1)" class="btn btn-primary">‚Üê Back</a></p>
        <div id="my-mirador"></div>

        <h2 class="text-center">From 
            {% if url %}
                <a href="{{ url }}" target="_blank">{{ title }}</a>
            {% else %}
                {{ title }}
            {% endif %}
        </h2>
        <p class="text-center">

            <b>{{ date }} | 
                {% if coverage %}
                    <a href="{{ coverage }}" target="_blank">{{ place }}</a>
                {% else %}
                    {{ place }}
                {% endif %}
            </b>
        </p>    
        {% if open == "true" %}
            <div class="col-md-6">
                {% for paragraph in paragraphs %}
                    {% set highlighted_paragraph = paragraph|replace(search_term, '<strong>' + search_term + '</strong>')|safe %}
                <p>{{ highlighted_paragraph }}</p>
                {% endfor %}
            </div>

            {% if images is not none %}
                <div class="col-md-6">
                    <img src="{{ images }}" alt="Thumbnail" onerror="this.style.display='none';" class="img-fluid ">
                </div>
            {% endif %}

        {% elif open == "false" %}
            <div class="col-md-12">
                <p>This text comes from a proprietary database and is unavailable due to copyright restrictions.</p>
            </div>
        
            <div class="col-md-12">
                {% if url is not none %}
                    <p><a href="{{ url }}" target="_blank">{{ url }}</a></p>
                {% endif %}
            </div>
        {% endif %}

        <script src="https://unpkg.com/mirador@latest/dist/mirador.min.js"></script>


        <script type="text/javascript">
            

                const miradorInstance = Mirador.viewer({
                id: "my-mirador",
                windows: [
                    {
                    manifestId:
                        "https://www.loc.gov/item/sn84020071/1838-08-02/ed-1/manifest.json",
                        "canvasIndex": 2,
                        view: 'single',

                    },
                ],
                    window: {
                        defaultView: 'single',
                        highlightAllAnnotations: true,
                        forceDrawAnnotations: true,
                    }
                });

                console.log(miradorInstance);

                const windowId = Object.keys(miradorInstance.store.getState().windows)[0];

                const percentages_boxToZoom = {
                x: 41.319597,
                y: 61.540608,
                width: 16.905962,
                height: 8.990371
                };

                const canvasDimensions = {
                width: 4562,
                height: 7166
                };

                const boxToZoom = {
                x: (percentages_boxToZoom.x / 100) * canvasDimensions.width,
                y: (percentages_boxToZoom.y / 100) * canvasDimensions.height,
                width: (percentages_boxToZoom.width / 100) * canvasDimensions.width,
                height: (percentages_boxToZoom.height / 100) * canvasDimensions.height
                };

                const zoomCenter = {
                x: boxToZoom.x + boxToZoom.width / 2,
                y: boxToZoom.y + boxToZoom.height / 2
                };

                var action = Mirador.actions.updateViewport(windowId, {
                x: zoomCenter.x,
                y: zoomCenter.y,
                zoom: 1 / boxToZoom.width
                });

                // fix timeout 
                setTimeout(() => {
                miradorInstance.store.dispatch(action);
                }, 2000);

            </script>
    </div>
{% endblock %}



